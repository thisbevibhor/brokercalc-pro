generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id             String           @id @default(uuid())
  email          String           @unique
  passwordHash   String
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  brokerAccounts BrokerAccount[]
  orders         Order[]
  calculations   Calculation[]
}

model BrokerAccount {
  id          String   @id @default(uuid())
  user        User     @relation(fields: [userId], references: [id])
  userId      String
  brokerName  String
  apiKey      String
  apiSecret   String
  connectedAt DateTime @default(now())
  orders      Order[]
}

model Order {
  id        String         @id @default(uuid())
  user      User           @relation(fields: [userId], references: [id])
  userId    String
  broker    BrokerAccount  @relation(fields: [brokerId], references: [id])
  brokerId  String
  type      String
  qty       Float
  price     Float
  tradeType String
  date      DateTime       @default(now())
}

model Calculation {
  id          String   @id @default(uuid())
  user        User     @relation(fields: [userId], references: [id])
  userId      String
  orders      String   // JSON string of order IDs
  buyTotal    Float
  sellTotal   Float
  buyCharges  Float
  sellCharges Float
  grossPL     Float
  netPL       Float
  createdAt   DateTime @default(now())
}
